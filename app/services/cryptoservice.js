"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var appSettings = require("application-settings");
var CryptoJS = require("crypto-js");
var CryptoServices;
(function (CryptoServices) {
    var secret;
    function GetEncryptedSecret() {
        return appSettings.getString("SECRET");
    }
    CryptoServices.GetEncryptedSecret = GetEncryptedSecret;
    function SetEncryptedSecret(ciphertext) {
        appSettings.setString("SECRET", ciphertext);
    }
    CryptoServices.SetEncryptedSecret = SetEncryptedSecret;
    function UnblockSecret(Password) {
        var encryptedsecret = GetEncryptedSecret();
        var secrethex = CryptoJS.AES.decrypt(encryptedsecret, Password);
        var sec = secrethex.toString(CryptoJS.enc.Utf8);
        if (!sec) {
            return false;
        }
        secret = sec;
        return true;
    }
    CryptoServices.UnblockSecret = UnblockSecret;
    function CreateSecret(Password) {
        var randomstring = Math.random().toString(36).slice(-16);
        var ciphertexthex = CryptoJS.AES.encrypt(randomstring, Password);
        var ciphertext = ciphertexthex.toString();
        appSettings.setString("SECRET", ciphertext);
        secret = randomstring;
    }
    CryptoServices.CreateSecret = CreateSecret;
    function Encode(Payload) {
        if (!secret)
            throw new Error("Secret not ublocked");
        return CryptoJS.AES.encrypt(Payload, secret);
    }
    CryptoServices.Encode = Encode;
    function Decode(Payload) {
        if (!secret)
            throw new Error("Secret not ublocked");
        return CryptoJS.AES.decrypt(Payload, secret).toString(CryptoJS.enc.Utf8);
    }
    CryptoServices.Decode = Decode;
})(CryptoServices = exports.CryptoServices || (exports.CryptoServices = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J5cHRvc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNyeXB0b3NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrREFBcUQ7QUFDckQsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRXBDLElBQWMsY0FBYyxDQXlDM0I7QUF6Q0QsV0FBYyxjQUFjO0lBQ3BCLElBQUksTUFBYSxDQUFDO0lBRWxCO1FBQ0ksTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUZlLGlDQUFrQixxQkFFakMsQ0FBQTtJQUVELDRCQUFtQyxVQUFpQjtRQUNoRCxXQUFXLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBQyxVQUFVLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRmUsaUNBQWtCLHFCQUVqQyxDQUFBO0lBRUQsdUJBQThCLFFBQWU7UUFDekMsSUFBSSxlQUFlLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQztRQUMzQyxJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDaEUsSUFBSSxHQUFHLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hELEVBQUUsQ0FBQSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQztZQUNMLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQztRQUNELE1BQU0sR0FBRyxHQUFHLENBQUM7UUFDYixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFUZSw0QkFBYSxnQkFTNUIsQ0FBQTtJQUVELHNCQUE2QixRQUFlO1FBQ3hDLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDekQsSUFBSSxhQUFhLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hFLElBQUksVUFBVSxHQUFHLGFBQWEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMxQyxXQUFXLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBQyxVQUFVLENBQUMsQ0FBQztRQUMzQyxNQUFNLEdBQUcsWUFBWSxDQUFDO0lBQzFCLENBQUM7SUFOZSwyQkFBWSxlQU0zQixDQUFBO0lBRUQsZ0JBQXVCLE9BQWM7UUFDakMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDUCxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBQyxNQUFNLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBSmUscUJBQU0sU0FJckIsQ0FBQTtJQUVELGdCQUF1QixPQUFjO1FBQ2pDLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUplLHFCQUFNLFNBSXJCLENBQUE7QUFDVCxDQUFDLEVBekNhLGNBQWMsR0FBZCxzQkFBYyxLQUFkLHNCQUFjLFFBeUMzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhcHBTZXR0aW5ncyA9IHJlcXVpcmUoXCJhcHBsaWNhdGlvbi1zZXR0aW5nc1wiKTtcbnZhciBDcnlwdG9KUyA9IHJlcXVpcmUoXCJjcnlwdG8tanNcIik7XG5cbmV4cG9ydCBtb2R1bGUgQ3J5cHRvU2VydmljZXN7XG4gICAgICAgIHZhciBzZWNyZXQ6c3RyaW5nO1xuICAgICAgICBcbiAgICAgICAgZXhwb3J0IGZ1bmN0aW9uIEdldEVuY3J5cHRlZFNlY3JldCgpOnN0cmluZ3tcbiAgICAgICAgICAgIHJldHVybiBhcHBTZXR0aW5ncy5nZXRTdHJpbmcoXCJTRUNSRVRcIik7ICAgXG4gICAgICAgIH1cblxuICAgICAgICBleHBvcnQgZnVuY3Rpb24gU2V0RW5jcnlwdGVkU2VjcmV0KGNpcGhlcnRleHQ6c3RyaW5nKXtcbiAgICAgICAgICAgIGFwcFNldHRpbmdzLnNldFN0cmluZyhcIlNFQ1JFVFwiLGNpcGhlcnRleHQpOyAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIGV4cG9ydCBmdW5jdGlvbiBVbmJsb2NrU2VjcmV0KFBhc3N3b3JkOnN0cmluZyk6Ym9vbGVhbiB7XG4gICAgICAgICAgICB2YXIgZW5jcnlwdGVkc2VjcmV0ID0gR2V0RW5jcnlwdGVkU2VjcmV0KCk7XG4gICAgICAgICAgICB2YXIgc2VjcmV0aGV4ID0gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoZW5jcnlwdGVkc2VjcmV0LCBQYXNzd29yZCk7XG4gICAgICAgICAgICB2YXIgc2VjID0gc2VjcmV0aGV4LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTtcbiAgICAgICAgICAgIGlmKCFzZWMpeyAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWNyZXQgPSBzZWM7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTsgICBcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZXhwb3J0IGZ1bmN0aW9uIENyZWF0ZVNlY3JldChQYXNzd29yZDpzdHJpbmcpOnZvaWQge1xuICAgICAgICAgICAgdmFyIHJhbmRvbXN0cmluZyA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKC0xNik7XG4gICAgICAgICAgICB2YXIgY2lwaGVydGV4dGhleCA9IENyeXB0b0pTLkFFUy5lbmNyeXB0KHJhbmRvbXN0cmluZyxQYXNzd29yZCk7XG4gICAgICAgICAgICB2YXIgY2lwaGVydGV4dCA9IGNpcGhlcnRleHRoZXgudG9TdHJpbmcoKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIGFwcFNldHRpbmdzLnNldFN0cmluZyhcIlNFQ1JFVFwiLGNpcGhlcnRleHQpO1xuICAgICAgICAgICAgc2VjcmV0ID0gcmFuZG9tc3RyaW5nOyAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGV4cG9ydCBmdW5jdGlvbiBFbmNvZGUoUGF5bG9hZDpzdHJpbmcpOnN0cmluZ3tcbiAgICAgICAgICAgIGlmKCFzZWNyZXQpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2VjcmV0IG5vdCB1YmxvY2tlZFwiKTtcbiAgICAgICAgICAgIHJldHVybiBDcnlwdG9KUy5BRVMuZW5jcnlwdChQYXlsb2FkLHNlY3JldCk7ICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBleHBvcnQgZnVuY3Rpb24gRGVjb2RlKFBheWxvYWQ6c3RyaW5nKTpzdHJpbmd7XG4gICAgICAgICAgICBpZighc2VjcmV0KVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlY3JldCBub3QgdWJsb2NrZWRcIik7XG4gICAgICAgICAgICByZXR1cm4gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoUGF5bG9hZCxzZWNyZXQpLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTsgICAgICAgICAgICAgXG4gICAgICAgIH0gICAgIFxufVxuXG4iXX0=